<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
  --mermaid-theme: night;
}

[lang='mermaid'] .label {
  color: #333;
}

/* CSS Document */

/** code highlight */

.cm-s-inner .cm-variable,
.cm-s-inner .cm-operator,
.cm-s-inner .cm-property {
    color: #b8bfc6;
}

.cm-s-inner .cm-keyword {
    color: #C88FD0;
}

.cm-s-inner .cm-tag {
    color: #7DF46A;
}

.cm-s-inner .cm-attribute {
    color: #7575E4;
}

.CodeMirror div.CodeMirror-cursor {
    border-left: 1px solid #b8bfc6;
    z-index: 3;
}

.cm-s-inner .cm-string {
    color: #D26B6B;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
    color: #DA924A;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
    color: #8d8df0;
}

.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
    color: #57ac57;
}

.cm-s-inner .cm-hr {
    color: #d8d5d5;
}

.cm-s-inner .cm-link {
    color: #d3d3ef;
}

.cm-s-inner .cm-negative {
    color: #d95050;
}

.cm-s-inner .cm-positive {
    color: #50e650;
}

.cm-s-inner .cm-string-2 {
    color: #f50;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
    color: #b7b3b3;
}

.cm-s-inner .cm-builtin {
    color: #f3b3f8;
}

.cm-s-inner .cm-bracket {
    color: #997;
}

.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
    color: #84B6CB;
}

.cm-s-inner .cm-number {
    color: #64AB8F;
}

.cm-s-inner .cm-variable {
    color: #b8bfc6;
}

.cm-s-inner .cm-variable-2 {
    color: #9FBAD5;
}

.cm-s-inner .cm-variable-3 {
    color: #1cc685;
}

.CodeMirror-selectedtext,
.CodeMirror-selected {
    background: #4a89dc;
    color: #fff !important;
    text-shadow: none;
}

.CodeMirror-gutters {
    border-right: none;
}

/* CSS Document */

/** markdown source **/
.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property
{
    color: #cebcca;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor{
    border-left: 3px solid #b8bfc6;
}

.cm-s-typora-default .cm-comment {
    color: #9FB1FF;
}

.cm-s-typora-default .cm-string {
    color: #A7A7D9
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
    color: #848695;
    font-style: italic;
}

.cm-s-typora-default .cm-link {
    color: #95B94B;
}

.cm-s-typora-default .CodeMirror-activeline-background {
    background: rgba(51, 51, 51, 0.72);
}

.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code {
	color: #8aa1e1;
}@import "";
@import "";
@import "";

:root {
    --bg-color:  #363B40;
    --side-bar-bg-color: #2E3033;
    --text-color: #b8bfc6;

    --select-text-bg-color:#4a89dc;

    --item-hover-bg-color: #0a0d16;
    --control-text-color: #b7b7b7;
    --control-text-hover-color: #eee;
    --window-border: 1px solid #555;

    --active-file-bg-color: rgb(34, 34, 34);
    --active-file-border-color: #8d8df0;

    --primary-color: #a3d5fe;

    --active-file-text-color: white;
    --item-hover-bg-color: #70717d;
    --item-hover-text-color: white;
    --primary-color: #6dc1e7;

    --rawblock-edit-panel-bd: #333;

    --search-select-bg-color: #428bca;
}

html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

html,
body {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    background: #363B40;
    background: var(--bg-color);
    fill: currentColor;
    line-height: 1.625rem;
}

#write {
    max-width: 914px;
}


@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

html,
body,
button,
input,
select,
textarea,
div.code-tooltip-content {
    color: #b8bfc6;
    border-color: transparent;
}

div.code-tooltip,
.md-hover-tip .md-arrow:after {
    background: #333;
}

.native-window #md-notification {
    border: 1px solid #70717d;
}

.popover.bottom > .arrow:after {
    border-bottom-color: #333;
}

html,
body,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

hr {
    height: 2px;
    border: 0;
    margin: 24px 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: sans-serif;
    font-weight: normal;
    clear: both;
    -ms-word-wrap: break-word;
    word-wrap: break-word;
    margin: 0;
    padding: 0;
    color: #DEDEDE
}

h1 {
    font-size: 2.5rem;
    /* 36px */
    line-height: 2.75rem;
    /* 40px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1.5px;
}

h2 {
    font-size: 1.63rem;
    /* 24px */
    line-height: 1.875rem;
    /* 30px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h3 {
    font-size: 1.17rem;
    /* 18px */
    line-height: 1.5rem;
    /* 24px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h4 {
    font-size: 1.12rem;
    /* 16px */
    line-height: 1.375rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    color: white;
}

h5 {
    font-size: 0.97rem;
    /* 16px */
    line-height: 1.25rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    font-weight: bold;
}

h6 {
    font-size: 0.93rem;
    /* 16px */
    line-height: 1rem;
    /* 16px */
    margin-bottom: 0.75rem;
    color: white;
}

@media (min-width: 980px) {
    h3.md-focus:before,
    h4.md-focus:before,
    h5.md-focus:before,
    h6.md-focus:before {
        color: #ddd;
        border: 1px solid #ddd;
        border-radius: 3px;
        position: absolute;
        left: -1.642857143rem;
        top: .357142857rem;
        float: left;
        font-size: 9px;
        padding-left: 2px;
        padding-right: 2px;
        vertical-align: bottom;
        font-weight: normal;
        line-height: normal;
    }

    h3.md-focus:before {
        content: 'h3';
    }

    h4.md-focus:before {
        content: 'h4';
    }

    h5.md-focus:before {
        content: 'h5';
        top: 0px;
    }

    h6.md-focus:before {
        content: 'h6';
        top: 0px;
    }
}

a {
    text-decoration: none;
    outline: 0;
}

a:hover {
    outline: 0;
}

a:focus {
    outline: thin dotted;
}

sup.md-footnote {
    background-color: #555;
    color: #ddd;
}

p {
    -ms-word-wrap: break-word;
    word-wrap: break-word;
}

p,
ul,
dd,
ol,
hr,
address,
pre,
table,
iframe,
.wp-caption,
.wp-audio-shortcode,
.wp-video-shortcode {
    margin-top: 0;
    margin-bottom: 1.5rem;
    /* 24px */
}

audio:not([controls]) {
    display: none;
}

[hidden] {
    display: none;
}

::-moz-selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

*.in-text-selection,
::selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

ul,
ol {
    padding: 0 0 0 1.875rem;
    /* 30px */
}

ul {
    list-style: square;
}

ol {
    list-style: decimal;
}

ul ul,
ol ol,
ul ol,
ol ul {
    margin: 0;
}

b,
th,
dt,
strong {
    font-weight: bold;
}

i,
em,
dfn,
cite {
    font-style: italic;
}

blockquote {
    padding-left: 1.875rem;
    margin: 0 0 1.875rem 1.875rem;
    border-left: solid 2px #474d54;
    padding-left: 30px;
    margin-top: 35px;
}

pre,
code,
kbd,
tt,
var {
    font-size: 0.875em;
    font-family: monospace;
}

code,
tt,
var {
    background: rgba(0, 0, 0, 0.05);
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
}

pre.md-fences {
    padding: 10px 10px 10px 30px;
    margin-bottom: 20px;
    background: #333;
}

.CodeMirror-gutters {
    background: #333;
    border-right: 1px solid transparent;
}

.enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip {
    bottom: -2.2em;
    right: 4px;
}

code,
kbd,
tt,
var {
    padding: 2px 5px;
}

table {
    max-width: 100%;
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
}

th,
td {
    padding: 5px 10px;
    vertical-align: top;
}

a {
    -webkit-transition: all .2s ease-in-out;
    transition: all .2s ease-in-out;
}

hr {
    background: #474d54;
    /* variable */
}

h1 {
    margin-top: 2em;
}

a {
    color: #e0e0e0;
    text-decoration: underline;
}

a:hover {
    color: #fff;
}

.md-inline-math script {
    color: #81b1db;
}

b,
th,
dt,
strong {
    color: #DEDEDE;
    /* variable */
}

mark {
    background: #D3D40E;
}

blockquote {
    color: #9DA2A6;
}

table a {
    color: #DEDEDE;
    /* variable */
}

th,
td {
    border: solid 1px #474d54;
    /* variable */
}

.task-list {
    padding-left: 0;
}

.md-task-list-item {
    padding-left: 1.25rem;
}

.md-task-list-item > input {
    top: auto;
}

.md-task-list-item > input:before {
    content: "";
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    border: 1px solid #b8bfc6;
    background-color: #363B40;
    margin-top: -0.4rem;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before {
    content: '\221A';
    /*◘*/
    font-size: 0.625rem;
    line-height: 0.625rem;
    color: #DEDEDE;
}

/** quick open **/
.auto-suggest-container {
    border: 0px;
    background-color: #525C65;
}

#typora-quick-open {
    background-color: #525C65;
}

#typora-quick-open input{
    background-color: #525C65;
    border: 0;
    border-bottom: 1px solid grey;
}

.typora-quick-open-item {
    background-color: inherit;
    color: inherit;
}

.typora-quick-open-item.active,
.typora-quick-open-item:hover {
    background-color: #4D8BDB;
    color: white;
}

.typora-quick-open-item:hover {
    background-color: rgba(77, 139, 219, 0.8);
}

.typora-search-spinner > div {
  background-color: #fff;
}

#write pre.md-meta-block {
    border-bottom: 1px dashed #ccc;
    background: transparent;
    padding-bottom: 0.6em;
    line-height: 1.6em;
}

.btn,
.btn .btn-default {
    background: transparent;
    color: #b8bfc6;
}

.ty-table-edit {
    border-top: 1px solid gray;
    background-color: #363B40;
}

.popover-title {
    background: transparent;
}

.md-image>.md-meta {
    color: #BBBBBB;
    background: transparent;
}

.md-expand.md-image>.md-meta {
    color: #DDD;
}

#write>h3:before,
#write>h4:before,
#write>h5:before,
#write>h6:before {
    border: none;
    border-radius: 0px;
    color: #888;
    text-decoration: underline;
    left: -1.4rem;
    top: 0.2rem;
}

#write>h3.md-focus:before {
    top: 2px;
}

#write>h4.md-focus:before {
    top: 2px;
}

.md-toc-item {
    color: #A8C2DC;
}

#write div.md-toc-tooltip {
    background-color: #363B40;
}

.dropdown-menu .btn:hover,
.dropdown-menu .btn:focus,
.md-toc .btn:hover,
.md-toc .btn:focus {
    color: white;
    background: black;
}

#toc-dropmenu {
    background: rgba(50, 54, 59, 0.93);
    border: 1px solid rgba(253, 253, 253, 0.15);
}

#toc-dropmenu .divider {
    background-color: #9b9b9b;
}

.outline-expander:before {
    top: 2px;
}

#typora-sidebar {
    box-shadow: none;
    border-right: 1px dashed;
    border-right: none;
}

.sidebar-tabs {
    border-bottom:0;
}

#typora-sidebar:hover .outline-title-wrapper {
    border-left: 1px dashed;
}

.outline-title-wrapper .btn {
    color: inherit;
}

.outline-item:hover {
    border-color: #363B40;
    background-color: #363B40;
    color: white;
}

h1.md-focus .md-attr,
h2.md-focus .md-attr,
h3.md-focus .md-attr,
h4.md-focus .md-attr,
h5.md-focus .md-attr,
h6.md-focus .md-attr,
.md-header-span .md-attr {
    color: #8C8E92;
    display: inline;
}

.md-comment {
    color: #5a95e3;
    opacity: 0.8;
}

.md-inline-math svg {
    color: #b8bfc6;
}

#math-inline-preview .md-arrow:after {
    background: black;
}

.modal-content {
    background: var(--bg-color);
    border: 0;
}

.modal-title {
    font-size: 1.5em;
}

.modal-content input {
    background-color: rgba(26, 21, 21, 0.51);
    color: white;
}

.modal-content .input-group-addon {
    color: white;
}

.modal-backdrop {
    background-color: rgba(174, 174, 174, 0.7);
}

.modal-content .btn-primary {
    border-color: var(--primary-color);
}

.md-table-resize-popover {
    background-color: #333;
}

.form-inline .input-group .input-group-addon {
    color: white;
}

#md-searchpanel {
    border-bottom: 1px dashed grey;
}

/** UI for electron */

.context-menu,
#spell-check-panel,
#footer-word-count-info {
    background-color: #42464A;
}

.context-menu.dropdown-menu .divider,
.dropdown-menu .divider {
    background-color: #777777;
    opacity: 1;
}

footer {
    color: inherit;
}

@media (max-width: 1000px) {
    footer {
        border-top: none;
    }
    footer:hover {
        color: inherit;
    }
}

#file-info-file-path .file-info-field-value:hover {
    background-color: #555;
    color: #dedede;
}

.megamenu-content,
.megamenu-opened header {
    background: var(--bg-color);
}

.megamenu-menu-panel h2,
.megamenu-menu-panel h1,
.long-btn {
    color: inherit;
}

.megamenu-menu-panel input[type='text'] {
    background: inherit;
    border: 0;
    border-bottom: 1px solid;
}

#recent-file-panel-action-btn {
    background: inherit;
    border: 1px grey solid;
}

.megamenu-menu-panel .dropdown-menu > li > a {
    color: inherit;
    background-color: #2F353A;
    text-decoration: none;
}

.megamenu-menu-panel table td:nth-child(1) {
    color: inherit;
    font-weight: bold;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(1) {
    color: white;
}

.modal-footer .btn-default, 
.modal-footer .btn-primary,
.modal-footer .btn-default:not(:hover) {
    border: 1px solid;
    border-color: transparent;
}

.btn-primary {
    color: white;
}

.btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
    color: white;
    border: 1px solid #ddd;
    background-color: inherit;
}

.modal-header {
    border-bottom: 0;
}

.modal-footer {
    border-top: 0;
}

#recent-file-panel tbody tr:nth-child(2n-1) {
    background-color: transparent !important;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(2) {
    color: inherit;
}

.megamenu-menu-panel .btn {
    border: 1px solid #eee;
    background: transparent;
}

.mouse-hover .toolbar-icon.btn:hover,
#w-full.mouse-hover,
#w-pin.mouse-hover {
    background-color: inherit;
}

.typora-node::-webkit-scrollbar {
    width: 5px;
}

.typora-node::-webkit-scrollbar-thumb:vertical {
    background: rgba(250, 250, 250, 0.3);
}

.typora-node::-webkit-scrollbar-thumb:vertical:active {
    background: rgba(250, 250, 250, 0.5);
}

#w-unpin {
    background-color: #4182c4;
}

#top-titlebar, #top-titlebar * {
    color: var(--item-hover-text-color);
}

.typora-sourceview-on #toggle-sourceview-btn,
#footer-word-count:hover,
.ty-show-word-count #footer-word-count {
    background: #333333;
}

#toggle-sourceview-btn:hover {
    color: #eee;
    background: #333333;
}

/** focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) * {
    color: #686868 !important;
}

.on-focus-mode .md-end-block:not(.md-focus) img,
.on-focus-mode .md-task-list-item:not(.md-focus-container)>input {
    opacity: #686868 !important;
}

.on-focus-mode li[cid]:not(.md-focus-container){
    color: #686868;
}

.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,
.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) * {
    color: #686868 !important;
}

.on-focus-mode .md-focus,
.on-focus-mode .md-focus-container {
    color: #fff;
}

.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) * {
    color: #686868 !important;
}


/*diagrams*/
#write .md-focus .md-diagram-panel {
    border: 1px solid #ddd;
    margin-left: -1px;
    width: calc(100% + 2px);
}

/*diagrams*/
#write .md-focus.md-fences-with-lineno .md-diagram-panel {
    margin-left: auto;
}

.md-diagram-panel-error {
    color: #f1908e;
}

.active-tab-files #info-panel-tab-file,
.active-tab-files #info-panel-tab-file:hover,
.active-tab-outline #info-panel-tab-outline,
.active-tab-outline #info-panel-tab-outline:hover {
    color: #eee;
}

.sidebar-footer-item:hover,
.footer-item:hover {
    background: inherit;
    color: white;
}

.ty-side-sort-btn.active,
.ty-side-sort-btn:hover,
.selected-folder-menu-item a:after {
    color: white;
}

#sidebar-files-menu {
    border:solid 1px;
    box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.79);
    background-color: var(--bg-color);
}

.file-list-item {
    border-bottom:none;
}

.file-list-item-summary {
    opacity: 1;
}

.file-list-item.active:first-child {
    border-top: none;
}

.file-node-background {
    height: 32px;
}

.file-library-node.active>.file-node-content,
.file-list-item.active {
    color: white;
    color: var(--active-file-text-color);
}

.file-library-node.active>.file-node-background{
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}
.file-list-item.active {
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}

#ty-tooltip {
    background-color: black;
    color: #eee;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-mathjax-midline {
    background-color: #57616b;
    border-bottom: none;
}

footer.ty-footer {
    border-color: #656565;
}

.ty-preferences .btn-default {
    background: transparent;
}
.ty-preferences .btn-default:hover {
    background: #57616b;
}

.ty-preferences select {
    border: 1px solid #989698;
    height: 21px;
}

.ty-preferences .nav-group-item.active,
.export-item.active,
.export-items-list-control,
.export-detail {
    background: var(--item-hover-bg-color);
}

.ty-preferences input[type="search"] {
    border-color: #333;
    background: #333;
    line-height: 22px;
    border-radius: 6px;
    color: white;
}

.ty-preferences input[type="search"]:focus {
    box-shadow: none;
}

[data-is-directory="true"] .file-node-content {
    margin-bottom: 0;
}

.file-node-title {
    line-height: 22px;
}

.html-for-mac .file-node-open-state, .html-for-mac .file-node-icon {
    line-height: 26px;
}

::-webkit-scrollbar-thumb {
    background: rgba(230, 230, 230, 0.30);
}

::-webkit-scrollbar-thumb:active {
    background: rgba(230, 230, 230, 0.50);
}

#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal {
    background: rgba(230, 230, 230, 0.30);
}

.nav-group-item:active {
    background-color: #474d54 !important;
}

.md-search-hit {
    background: rgba(199, 140, 60, 0.81);
    color: #eee;
}

.md-search-hit * {
    color: #eee;
}

#md-searchpanel input {
    color: white;
}

.modal-backdrop.in {
    opacity: 1;
    backdrop-filter: blur(1px);
}

.clear-btn-icon {
    top: 8px;
}

/* try fix https://github.com/typora/typora-issues/issues/5253 */
.file-node-expanded>.file-node-children {
    display: grid;
  }


 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} h1,h2,h3,h4,h5 {white-space:pre-line}
</style><title>formats</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='indranet-protocol-message-format'><span>Indranet Protocol Message Format</span></h1><p><span>The initial idea for Indranet was just as a replacement for the Tor network, but</span>
<span>it quickly became obvious that it can be rethought as a generic, programmable</span>
<span>relay network.</span></p><p><span>The specification is intended to be as open ended as possible and relays process</span>
<span>messages without any limitations on how they can be constructed, so that</span>
<span>developers can tailor them to their use case, and importantly, so that these</span>
<span>different uses are not mutually exclusive.</span></p><p><span>In this text there is quite a number of specialist terms related to cryptography</span>
<span>and binary encoding schemes, see the </span><a href='#glossary'><span>Glossary</span></a><span> for explanations.</span></p><h2 id='contents'><span>Contents</span></h2><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" href="#indranet-protocol-message-format">Indranet Protocol Message Format</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n5"><a class="md-toc-inner" href="#contents">Contents</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n7"><a class="md-toc-inner" href="#cryptographic-algorithms">Cryptographic Algorithms</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n8"><a class="md-toc-inner" href="#cryptographic-hash-function">Cryptographic Hash Function</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n9"><a class="md-toc-inner" href="#sha256">SHA256</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n13"><a class="md-toc-inner" href="#elliptic-curve-group">Elliptic Curve Group</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n14"><a class="md-toc-inner" href="#secp256k1">secp256k1</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n664"><a class="md-toc-inner" href="#ec-signatures">EC Signatures</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n18"><a class="md-toc-inner" href="#schnorr">Schnorr</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n668"><a class="md-toc-inner" href="#cloaked-public-key">Cloaked Public Key</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n675"><a class="md-toc-inner" href="#symmetric-encryption">Symmetric Encryption</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n26"><a class="md-toc-inner" href="#aes-ctr-block-cipher-with-schnorr-signature-mac">AES-CTR Block Cipher with Schnorr Signature MAC</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n29"><a class="md-toc-inner" href="#forward-error-correction">Forward Error Correction</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n680"><a class="md-toc-inner" href="#field-types">Field Types</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n32"><a class="md-toc-inner" href="#magic">Magic</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n685"><a class="md-toc-inner" href="#private-key">Private Key</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n690"><a class="md-toc-inner" href="#public-key">Public Key</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n696"><a class="md-toc-inner" href="#cloaked-public-key-2">Cloaked Public Key</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n701"><a class="md-toc-inner" href="#integers">Integers</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n706"><a class="md-toc-inner" href="#initialisation-vectors">Initialisation Vectors</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n47"><a class="md-toc-inner" href="#primitives">Primitives</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n48"><a class="md-toc-inner" href="#session">Session</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n711"><a class="md-toc-inner" href="#forward">Forward</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n716"><a class="md-toc-inner" href="#crypt">Crypt</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n721"><a class="md-toc-inner" href="#reply">Reply</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n726"><a class="md-toc-inner" href="#header">Header</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n731"><a class="md-toc-inner" href="#extra-data">Extra Data</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n736"><a class="md-toc-inner" href="#ciphers">Ciphers</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n741"><a class="md-toc-inner" href="#initialisation-vectors-2">Initialisation Vectors</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n746"><a class="md-toc-inner" href="#sentinel">Sentinel</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n751"><a class="md-toc-inner" href="#exit">Exit</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n756"><a class="md-toc-inner" href="#request">Request</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n761"><a class="md-toc-inner" href="#response">Response</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n766"><a class="md-toc-inner" href="#delay">Delay</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n771"><a class="md-toc-inner" href="#pad-incrementdecrement">Pad (Increment/Decrement)</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n776"><a class="md-toc-inner" href="#dummy">Dummy</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n781"><a class="md-toc-inner" href="#split">Split</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n786"><a class="md-toc-inner" href="#low-latency-mixnet-lightning-bolts">Low Latency Mixnet "Lightning Bolts"</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n791"><a class="md-toc-inner" href="#network-intelligence">Network Intelligence</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n796"><a class="md-toc-inner" href="#ad-prototype">Ad Prototype</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n801"><a class="md-toc-inner" href="#peer">Peer</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n806"><a class="md-toc-inner" href="#addresses">Addresses</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n811"><a class="md-toc-inner" href="#services">Services</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n816"><a class="md-toc-inner" href="#hidden-services">Hidden Services</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n461"><a class="md-toc-inner" href="#overview">Overview</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n463"><a class="md-toc-inner" href="#alice">Alice</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n465"><a class="md-toc-inner" href="#bob">Bob</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n467"><a class="md-toc-inner" href="#faith">Faith</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n821"><a class="md-toc-inner" href="#hidden-service-protocol">Hidden Service Protocol</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n826"><a class="md-toc-inner" href="#protocol-messages-for-hidden-services">Protocol Messages for Hidden Services</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n498"><a class="md-toc-inner" href="#intro">Intro</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n851"><a class="md-toc-inner" href="#rate-limiting-hidden-service-advertisements">Rate Limiting Hidden Service Advertisements</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n862"><a class="md-toc-inner" href="#introduction">Introduction</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n867"><a class="md-toc-inner" href="#route">Route</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n872"><a class="md-toc-inner" href="#ready">Ready</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n877"><a class="md-toc-inner" href="#hidden-message-cycles">Hidden Message Cycles</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n882"><a class="md-toc-inner" href="#example-custom-protocols">Example Custom Protocols</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n611"><a class="md-toc-inner" href="#glossary">Glossary</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n887"><a class="md-toc-inner" href="#based32">Based32</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n892"><a class="md-toc-inner" href="#client">Client</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n897"><a class="md-toc-inner" href="#ecdh">ECDH</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n902"><a class="md-toc-inner" href="#header-key">Header Key</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n907"><a class="md-toc-inner" href="#payload-key">Payload Key</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n912"><a class="md-toc-inner" href="#initialisation-vector">Initialisation Vector</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n917"><a class="md-toc-inner" href="#fingerprint">Fingerprint</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n922"><a class="md-toc-inner" href="#nonce">Nonce</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n927"><a class="md-toc-inner" href="#relay">Relay</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n932"><a class="md-toc-inner" href="#sessions">Sessions</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n937"><a class="md-toc-inner" href="#preimage">Preimage</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n942"><a class="md-toc-inner" href="#magic-bytes">Magic Bytes</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n947"><a class="md-toc-inner" href="#cloaked-key">Cloaked Key</a></span></p></div><h2 id='cryptographic-algorithms'><span>Cryptographic Algorithms</span></h2><h3 id='cryptographic-hash-function'><span>Cryptographic Hash Function</span></h3><h4 id='sha256'><span>SHA256</span></h4><p><span>This hash function is still considered to be secure, and in Indra it uses an</span>
<span>AVX2 implementation on AMD64 platform, which is sufficiently fast.</span></p><p><span>Blake 2 and 3 are trendy hash functions that claim higher performance, but real</span>
<span>world performance is maybe 12% faster and has a shorter history and less</span>
<span>attempts to break it.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='elliptic-curve-group'><span>Elliptic Curve Group</span></h3><h4 id='secp256k1'><span>secp256k1</span></h4><p><span>Again, it is trendy to use the Edwards 25519 curve, and that group has slightly</span>
<span>better properties in it&#39;s symmetries, but this curve has not been broken after</span>
<span>far more attempts, and is not used with a weak HD derivation algorithm, keys are</span>
<span>only derived from fresh entropy.</span></p><p><span>Indra does not have a wallet and keys are changed periodically as the number of</span>
<span>signatures generated exceeds a conservative number.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='ec-signatures'><span>EC Signatures</span></h3><h4 id='schnorr'><span>Schnorr</span></h4><p><span>For reasons of performance and data structure uniformity, Indra uses Schnorr</span>
<span>signatures, which also provides a uniform size, and can be reduced in length</span>
<span>from the standard 64 bytes to 48 bytes if the keys are changed more frequently</span>
<span>and if desired can, like ECDSA signatures used in Bitcoin embed the public key</span>
<span>where security reasons recommend cloaking it until after the cloaked form (&quot;</span>
<span>address&quot;) is signed and then won&#39;t be reused.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='cloaked-public-key'><span>Cloaked Public Key</span></h3><p><span>In order to prevent the correlation of packets to session public keys, Indra</span>
<span>uses a construction of 4 byte random blinding factor, which is then concatenated</span>
<span>at the end of the 33 byte public key, and the first 4 bytes of the SHA256 hash</span>
<span>of this combined byte slice is appended to the blinding factor prefix.</span></p><p><span>Only the relay who has the private key matching the public key in their session</span>
<span>database can generate this matching value, any attacker cannot.</span></p><p><span>Any </span><a href='#crypt'><span>Crypt</span></a><span> inadvertently delivered to a relay other than the one</span>
<span>intended by the client will thus leak no information about the identity of the</span>
<span>session, thus defeating attempts to correlate the session, and thus origin of a</span>
<span>message, from evil relays seeing such messages passing through a common relay on</span>
<span>their path.</span></p><p><span>This is unlikely to happen anyway, as point to paint connections that pass</span>
<span>through a relay are coming from potentially many different previous hops, and</span>
<span>the use of a relay for different positions in a path are different sessions, as</span>
<span>well.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='symmetric-encryption'><span>Symmetric Encryption</span></h3><h4 id='aes-ctr-block-cipher-with-schnorr-signature-mac'><span>AES-CTR Block Cipher with Schnorr Signature MAC</span></h4><p><span>AES-CTR is a fast, block cipher method, with no authentication. Rather than use a plurality of authentication methods, and because Schnorr signatures are quite efficient, encryption of messages requires the inserting of the signature prior to the position indicated by the Offset of the </span><a href='#crypt'><span>Crypt</span></a><span>, or in other words, at the end of the encrypted message.</span></p><p><span>EC signatures are as strong authenticity protection as it is possible to achieve, not a lesser, weaker form like used in many HMACs. The signature is based on the hash of the message, and so the message checksum need not be independently made. Either the signature is valid on the message hash, or some part of it is corrupt and the whole message is rejected and if protocol allows it, a retransmit request would be sent to try again.</span></p><h3 id='forward-error-correction'><span>Forward Error Correction</span></h3><p><span>Indra uses Reed Solomon FEC with a dynamic adjustment that aims to maintain a</span>
<span>buffer against the need for retransmit, and starts with a conservatively high</span>
<span>redundancy ratio that adjusts slowly downwards to prevent retransmit latency.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='field-types'><span>Field Types</span></h3><h3 id='magic'><span>Magic</span></h3><p><span>This is a 4 byte string, as 4 8-bit ASCII, usually resembling or containing the</span>
<span>message type in human readable form.</span></p><p><span>32 bit values like this are a common bit width for formatting sentinels that</span>
<span>indicate that a specific message format follows.</span></p><p><span>It is sufficiently long as to be unlikely to occur, let alone in the protocol</span>
<span>specified position in the message bytes.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='private-key'><span>Private Key</span></h3><p><span>This is a 32 byte, 256 bit long random value, with the limitation of it being a</span>
<span>member of the elliptic curve group secp256k1.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='public-key'><span>Public Key</span></h3><p><span>The public key is a standard 257 bit, 33 byte public key, the additional bit</span>
<span>being the sign of coordinate of the key.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='cloaked-public-key-2'><span>Cloaked Public Key</span></h3><p><span>As described elsewhere, the Cloaked Public Key is constructed using a 4 byte</span>
<span>random blinding factor that is appended to the public key bytes, hashed, and the</span>
<span>first 4 bytes of this hash are appended to the blinding factor.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='integers'><span>Integers</span></h3><p><span>All standard integer types are supported, and are encoded with Little Endian</span>
<span>byte ording that is native to most modern CPUs.</span></p><p><span>In addition to the 8, 16, 32 and 64 bit values, which can also be signed, there</span>
<span>is a 3 byte long, 24 bit value used in several messages for a maximum length of</span>
<span>16 Megabytes, being a reasonable maximum message payload size.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='initialisation-vectors'><span>Initialisation Vectors</span></h3><p><span>16 bytes long Initialisation Vectors, the most common standard AES encryption</span>
<span>Initialisation Vectors are used in Indra for symmetric encryption</span>
<span>using </span><a href='#ecdh'><span>ECDH</span></a><span> derived public/private keys.</span></p><h2 id='primitives'><span>Primitives</span></h2><h3 id='session'><span>Session</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>sess</code></td></tr><tr><td><span>32</span></td><td><span>Header</span></td><td><span>Symmetric ECDH private key used in reply headers and simple forwards</span></td></tr><tr><td><span>32</span></td><td><span>Payload</span></td><td><span>Symmetric ECDH private key used for encrypting response payloads</span></td></tr></tbody></table></figure><p><span>The session is the most important and primary message type in the sense that it</span>
<span>must be delivered in order for a relay to be obliged to perform services for</span>
<span>clients.</span></p><p><span>Sessions contain a </span><a href='#header'><span>Header</span></a><span> key and a </span><a href='#'><span>Payload</span></a><span> key, which is</span>
<span>described in the </span><a href='#reply'><span>Reply</span></a><span> section in the following.</span></p><p><span>The session is a reference to a pre-paid balance, against which a bytes/time</span>
<span>rate is applied to messages that are forwarded via the session.</span></p><p><span>The session also can be alternatively billed on a different rate</span>
<span>for </span><a href='#exit'><span>Exit</span></a><span> messages, as described elsewhere.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='forward'><span>Forward</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>frwd</code></td></tr><tr><td><span>33</span></td><td><span>Relay</span></td><td><span>Public identity key of relay to forward this message to</span></td></tr></tbody></table></figure><p><span>The number one task of Indranet relays is to accept a message, and forward it to</span>
<span>another relay. They do this only under the proviso that there is a session that</span>
<span>has been established and paid for using the </span><a href='#session'><span>Session</span></a></p><p><span>The Indra protocol</span>
<span>is </span><a href='https://en.wikipedia.org/wiki/Connectionless_communication'><span>connectionless</span></a>
<span>because relays do not participate in making routing decisions, and thus also the</span>
<span>low level network transport used does not have a handshake for the base case of</span>
<span>relaying a message according to instructions in the decrypted part at the head</span>
<span>of the message.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='crypt'><span>Crypt</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>cryp</code></td></tr><tr><td><span>8</span></td><td><span>Cloaked</span><span>*</span><span> Header public key</span></td><td><span>Indicates to the valid receiver which public key is being used.</span></td></tr><tr><td><span>33</span></td><td><span>Message public key</span></td><td><span>(sender generated one-time)</span></td></tr><tr><td><span>16</span></td><td><span>Initialisation Vector</span></td><td><span>standard AES high entropy random value)</span></td></tr><tr><td><span>3</span></td><td><span>Offset</span></td><td><span>24 bit vector (up to 16Mb header) for beginning of payload (using Payload key from </span><a href='#session'><span>Session</span></a><span>)</span></td></tr></tbody></table></figure><p><span>The second most important message type in Indranet is the </span><a href='#crypt'><span>Crypt</span></a><span>.</span></p><p><span>The crypt is an encrypted message, consisting of a header containing a cloaked</span>
<span>session key referring to the session private key, and the random seed value used</span>
<span>to prevent the possibility of plaintext cryptanalysis attacks.</span></p><p><span>The crypt specifies encryption that is used to &quot;wrap&quot; the remainder of a message</span>
<span>so that only the intended recipient can see it, a combination of encryption and</span>
<span>authentication rolled into one.</span></p><p><span>The </span><code>Offset</code><span> field is encrypted as the first 3 bytes of the encryption that uses</span>
<span>the </span><a href='#header'><span>Header</span></a><span> key, indicates the point at which the use of this key ends</span>
<span>and the second key, the </span><a href='#'><span>Payload</span></a><span> key is used for the remainder. If</span>
<span>this value is zero, there is no boundary and the Header key is to be used up to</span>
<span>the end of the message. This value can refer to a distance that is beyond the</span>
<span>end of the last parts of the </span><a href='#reply'><span>Reply</span></a><span> bundle, to defeat any estimation of</span>
<span>the number of layers that it may contain.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='reply'><span>Reply</span></h3><p><span>In order to facilitate the return of an arbitrary blob of data as a reply to a</span>
<span>message sent out by a client, there is a special construction of pre-made</span>
<span>message which contains an header containing the forwarding and encrypted layers</span>
<span>for the reply message.</span></p><p><span>To enable this, there is the </span><a href='#header'><span>Header</span></a><span>/</span><a href='#'><span>Payload</span></a><span> key pair, the</span>
<span>first is used on the header, and via the </span><a href='#'><span>Offset</span></a><span> field in</span></p><blockquote><p><span>In order to prevent the depth of the chain of forwards from being visible to</span>
<span>relays, there must also be a random, arbitrary padding at the end of the</span>
<span>header.</span>
<span>Initially a rigid design was intended to cloak this, hiding the position on</span>
<span>the</span>
<span>path by it being moved upwards and padded back out for the next step, so a</span>
<span>random length of padding that varies enough to make it difficult to know how</span>
<span>many layers might be inside it must be used.</span></p><p><span>Because, also, the size of the Forward and Crypt messages are fixed, this</span>
<span>header will be padded out as though there is one or several more layers than</span>
<span>are</span>
<span>actually present, in order to obscure any information about the real length of</span>
<span>the path.</span></p></blockquote><p><a href='#contents'><span>⤴️</span></a></p><h3 id='header'><span>Header</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>2</span></td><td><span>Length</span></td><td><span>Length of Header, after which Extra Data is found</span></td></tr><tr><td><span>...</span></td><td><span>...</span></td><td><span>repeat 1 or more </span><a href='#forward'><span>Forward</span></a><span>, </span><a href='#crypt'><span>Crypt</span></a><span> and then optionally </span><a href='#delay'><span>Delay</span></a><span>, </span><a href='#dummy'><span>Dummy</span></a><span> and </span><a href='#'><span>Pad</span></a><span> layers</span></td></tr></tbody></table></figure><p><a href='#contents'><span>⤴️</span></a></p><h3 id='extra-data'><span>Extra Data</span></h3><p><span>These are found directly appended to the end of the above header</span></p><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>2</span></td><td><span>Count</span></td><td><span>Number of Ciphers/IVs found in the following.</span></td></tr><tr><td><span>32</span></td><td><span>Ciphers</span></td><td><span>Pre-generated symmetric ciphers created with Payload session key and the same public key found in the matching Header layer (hidden from Exit/Hidden Service via encryption)</span></td></tr><tr><td><span>16</span></td><td><span>IVs</span></td><td><span>IVs that match the ones used in the header Crypt layers</span></td></tr><tr><td><span>4</span></td><td><span>Sentinel</span></td><td><span>Magic bytes indicating the sender defined sentinel to place at the proper end of the response bundled using the Reply</span></td></tr></tbody></table></figure><p><a href='#contents'><span>⤴️</span></a></p><h3 id='ciphers'><span>Ciphers</span></h3><p><span>Sessions consist of two symmetric secret keys, the </span><a href='#header'><span>Header</span></a><span> and</span>
<span>the </span><a href='#'><span>Payload</span></a><span> keys. The </span><a href='#header'><span>Header</span></a><span> key is used in the header</span>
<span>shown above, to derive the Cloaked session header public key.</span></p><p><span>The Ciphers contain a series of symmetric secret keys that are the product of</span>
<span>using ECDH on the one-time public key in the </span><a href='#crypt'><span>Crypt</span></a><span>, and the</span>
<span>session </span><a href='#'><span>Payload</span></a><span> key. The relay can thus encrypt an arbitrary message</span>
<span>payload using this key</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='initialisation-vectors-2'><span>Initialisation Vectors</span></h3><p><span>The IVs used with the ciphers above, and wrapped in the </span><a href='#crypt'><span>Crypt</span></a>
<span>messages, must be a separate set of IVs from the ones in the header. They must</span>
<span>also be the same number as the </span><a href='#ciphers'><span>Ciphers</span></a><span>.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='sentinel'><span>Sentinel</span></h3><p><span>A special, random string of bytes is provided alongside the pad length that is</span>
<span>to be placed at the end of the padding, which when the reply is received, the</span>
<span>client can see where the original message ending was, and thus the pad, which if</span>
<span>it is a mismatch to what was prescribed, is a bannable offence that will cause</span>
<span>the client to deprecate the use of the exit node as a consequence.</span></p><p><span>If this recurs, the next ban score increase must be a multiple of the previous,</span>
<span>until the threshold for outright permanent banning shall be applied. This should</span>
<span>only take at most 3 incidents to be certain there was no accident.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='exit'><span>Exit</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><span>Sentinel marker for beginning/end of messages</span></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Database key for retrieving pending message</span></td></tr><tr><td><span>2</span></td><td><span>Port</span></td><td><span>Well known port </span><span>*</span></td></tr><tr><td><span>...</span></td><td><span>Reply</span></td><td><span>Header, Ciphers and Initialisation Vectors for bundling Response</span></td></tr><tr><td><span>4</span></td><td><span>Length</span></td><td><span>Length of data following that contains request</span></td></tr><tr><td><span>...</span></td><td><span>Request</span></td><td><span>Message to forward to Service via local port forward</span></td></tr></tbody></table></figure><p><span>The Exit message is a request to tunnel a packet out of the Indra network.</span></p><p><span>Indra nodes advertise these as </span><em><span>Services</span></em><span>, which are identified by a Well Known</span>
<span>Port, such as 80 for HTTP, 443 for HTTPS, 25 for SMTP, 22 for SSH, and so on.</span></p><p><span>Traffic that is forwarded to a </span><em><span>Service</span></em><span> is billed according to the average of</span>
<span>the inbound message size and the outbound message size that is received back</span>
<span>from the service in response to the request that was received inside the Exit</span>
<span>message.</span></p><blockquote><p><span>*</span><span> Well known ports are generally defined in unix for the privileged low</span>
<span>ports, but also in protocols, such as 8333 for Bitcoin, 9050 for Tor, etc.</span></p><p><span>A list will be compiled to add any extra features that are not services that</span>
<span>would normally be defined as they are not normally public.</span></p><p><span>For example, proxy port numbers are arbitrary, but we might specify they are</span>
<span>to always be, say, 8080 for a HTTP proxy, or 8004 for Socks 4A or 8005 for</span>
<span>Socks</span>
<span>5, and so on. These will most likely be the loopback ports that are usually</span>
<span>used</span>
<span>or even specified in the protocol, even though for clearnet use such an open</span>
<span>relay would be a security/spam risk, this is the purpose of Indra, and spam is</span>
<span>controlled separately by the metering of data volume for relaying</span></p></blockquote><p><a href='#contents'><span>⤴️</span></a></p><h3 id='request'><span>Request</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>requ</code></td></tr><tr><td><span>3</span></td><td><span>Length</span></td><td><span>24 bit value for the length of the message, i.e.: up to 16 Megabytes</span></td></tr><tr><td><span>...</span></td><td><span>Data</span></td><td><span>The payload of the Request</span></td></tr></tbody></table></figure><p><span>Request is exactly a standard request message for a server as found in all</span>
<span>Client/Server protocols. It is simply a wrapper for an arbitrary payload of</span>
<span>data.</span></p><p><span>Note that this, and the Response message are 24 bits and limit to 16 Megabytes</span>
<span>in size. Messages containing payloads longer than this must be segmented at the</span>
<span>application level.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='response'><span>Response</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>resp</code></td></tr><tr><td><span>3</span></td><td><span>Length</span></td><td><span>24 bit value for the length of the message, i.e.: up to 16 Megabytes</span></td></tr><tr><td><span>...</span></td><td><span>Data</span></td><td><span>The content of the Response</span></td></tr></tbody></table></figure><p><span>Response is the message wrapper for the response from a Service.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='delay'><span>Delay</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>dely</code></td></tr><tr><td><span>4</span></td><td><span>Delay</span></td><td><span>Number of milliseconds to hold message in cache before processing next message layer</span></td></tr></tbody></table></figure><p><span>In order to add some temporal jitter and to arbitrarily increase and decrease</span>
<span>the size of the layers that are stacked at the head of messages, it is possible</span>
<span>to add a specification that provides a millisecond precision 32 bit value</span>
<span>specifying an amount of time to hold the message in the buffer before sending</span>
<span>it.</span></p><p><span>In order to facilitate this the relays must charge according to a coefficient</span>
<span>multiplied by the time of delays against the message size.</span></p><p><span>For this reason also, as will be explained with </span><a href='#'><span>Pad</span></a><span>, this is entirely</span>
<span>under the control of the client for both reasons of securing anonymity as well</span>
<span>as permitting applications to add these to messages for whatever purpose the</span>
<span>application developer envisions, such as, potentially, storing data temporarily</span>
<span>out of band for a prescribed amount of time as a form of &quot;cloud storage&quot;.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='pad-incrementdecrement'><span>Pad (Increment/Decrement)</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>pado</code></td></tr><tr><td><span>2</span></td><td><span>Difference</span></td><td><span>16 bit signed value that allows up to 32 Kilobytes of data to be added or removed from the message by the relay.</span></td></tr></tbody></table></figure><p><span>Pad is an instruction to append or trim bytes</span></p><p><span>Outside of the anonymity quality-of-service, reciprocating dummy traffic that</span>
<span>peers will send to each other, using a scheme of fractional reserve for allowing</span>
<span>temporal disjoint reciprocation, or whatever scheme ends up being used, the</span>
<span>client needs to have control over how the size of their messages is altered</span>
<span>deliberately in transit.</span></p><p><span>Failing to perform this is not detectable except in the last hop before the node</span>
<span>as being the act of a given relay, but the client will recognise this as a sign</span>
<span>that one of the hops in the path was processed not in accordance with the</span>
<span>instructions and all nodes in the path will have a ban score increment the</span>
<span>existence of which will prejudice greater ban scores if the error repeats in</span>
<span>paths the relay is part of in future.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='dummy'><span>Dummy</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>dumm</code></td></tr><tr><td><span>3</span></td><td><span>Length</span></td><td><span>The amount of random garbage following</span></td></tr></tbody></table></figure><p><span>Dummy messages are messages that are the intentional delivery of data that is to</span>
<span>be discarded. Because of anonymity, there is no way to attribute fault to</span>
<span>erroneous forwarding if something other than Dummy appears and needs to be</span>
<span>dropped, but Dummy specifically is a request to accept and drop data.</span></p><p><span>Because this is a receive, but not send, it is charged at half the RelayRate</span>
<span>advertised by the relay, in the same way that Exit and Hidden Service Responses</span>
<span>are computed by the average of the in and outbound data size.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='split'><span>Split</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>splt</code></td></tr><tr><td><span>2</span></td><td><span>Count</span></td><td><span>Indicates the number of splits following</span></td></tr><tr><td><span>4</span></td><td><span>Offsets</span></td><td><em><span>Count</span></em><span> number of 32 bit offset values marking the segments</span></td></tr><tr><td><span>...</span></td><td><span>Data</span></td><td><span>The segments that begin from the end of the Offsets/Destinations and continue until the end of the message.</span></td></tr></tbody></table></figure><p><span>Split is where the remainder of the message has 2 or more segments that each</span>
<span>bear a header indicating a different destination. This could be used, for</span>
<span>example, to create a liveness detection along an arbitrary route that conceals</span>
<span>the return paths of this telemetry.</span></p><p><span>Splits also make possible the fan-out/fan/in pattern for multipath messages.</span></p><p><span>The actual instructions on where to forward the segments is at the head of each</span>
<span>segment in cleartext.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='low-latency-mixnet-lightning-bolts'><span>Low Latency Mixnet &quot;Lightning Bolts&quot;</span></h3><p><span>One of the biggest difficulties with mixnets is that the lower the latency, the</span>
<span>easier it is to correlate traffic paths as they flow through the network.</span></p><p><span>Defeating this attack can be achieved by adding </span><a href='#split'><span>Split</span></a><span> messages fan out</span>
<span>randomly to deliver empty or padding, so that at each hop, at least two</span>
<span>different simultaneous transmissions take place.</span></p><p><span>These forks should be constructed using </span><a href='#dummy'><span>Dummy</span></a><span> packets after</span>
<span>the </span><a href='#forward'><span>Forward</span></a><span> and </span><a href='#crypt'><span>Crypt</span></a><span> messages in front of it, which may</span>
<span>then be followed by further layers for second or third or further movements. In</span>
<span>fact, Dummy padding can be used in addition to the Delay and Pad instruction</span>
<span>messages as well to further break up the regularity of the sizes of forwarding</span>
<span>segments.</span></p><p><span>These can be called Lightning Bolts since they propagate in a similar way as</span>
<span>arcs of electricity across the sky and to the ground, forking towards equally</span>
<span>conductive or from equally charged areas that merge or split.</span></p><p><span>The simulation of merging can even be created, as well, with forks that merge</span>
<span>back together.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='network-intelligence'><span>Network Intelligence</span></h3><p><span>In source routing systems, the nodes that perform relaying services must</span>
<span>advertise their existence and instructions on how to reach them.</span></p><p><span>All advertisements contain the following 4 fields, and additional fields as</span>
<span>required:</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='ad-prototype'><span>Ad Prototype</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>!!!!</code><span> (This item does not exist alone)</span></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Random value that ensures the signature is never placed on the same hash</span></td></tr><tr><td><span>33</span></td><td><span>Key</span></td><td><span>The public identity key of the relay providing relaying or other service</span></td></tr><tr><td><span>8</span></td><td><span>Expiry</span></td><td><span>The timestamp after which the ad must be renewed as all peers will evict the record from their network intelligence database</span></td></tr><tr><td><span>64</span></td><td><span>Signature</span></td><td><span>Schnorr signature that must match with the Key field above</span></td></tr></tbody></table></figure><p><span>These are the 4 essential elements in an ad, as shown above, and all the ads for</span>
<span>both public and hidden services contain this. The signature, of course, is</span>
<span>always at the end, but the order of the fields </span><em><span>could</span></em><span> be different.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='peer'><span>Peer</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>peer</code></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Random value that ensures the signature is never placed on the same hash</span></td></tr><tr><td><span>33</span></td><td><span>Key</span></td><td><span>The public identity key of the relay providing relaying or other service</span></td></tr><tr><td><span>8</span></td><td><span>Expiry</span></td><td><span>The timestamp after which the ad must be renewed as all peers will evict the record from their network intelligence database after this time. This is both to keep the network metadata fresh, and to help keep cache sizes reasonable.</span></td></tr><tr><td><span>4</span></td><td><span>RelayRate</span></td><td><span>The price, in MilliSatoshi, for a megabyte of data</span></td></tr><tr><td><span>64</span></td><td><span>Signature</span></td><td><span>Schnorr signature that must match with the Key field above</span></td></tr></tbody></table></figure><p><span>Peer is simply the advertising of the identity of a peer. It contains only the</span>
<span>public identity key, and the relay rate charged by it.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h3 id='addresses'><span>Addresses</span></h3><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>addr</code></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Random value that ensures the signature is never placed on the same hash</span></td></tr><tr><td><span>33</span></td><td><span>Key</span></td><td><span>The public identity key of the relay providing relaying or other service</span></td></tr><tr><td><span>8</span></td><td><span>Expiry</span></td><td><span>The timestamp after which the ad must be renewed as all peers will evict the record from their network intelligence database</span></td></tr><tr><td><span>1</span></td><td><span>Count</span></td><td><span>Number of addresses listed in this, maximum of 256, 0 being the first</span></td></tr><tr><td><span>8/20/?</span></td><td><span>Addresses</span></td><td><span>Network Addresses - variable length. IPv4 and IPv6 encoding lengths with 2 byte port numbers added</span></td></tr><tr><td><span>64</span></td><td><span>Signature</span></td><td><span>Schnorr signature that must match with the Key field above</span></td></tr></tbody></table></figure><p><a href='#contents'><span>⤴️</span></a></p><h3 id='services'><span>Services</span></h3><p><span>The first type of service provided over Indranet is public </span><strong><span>Services</span></strong><span>. These</span>
<span>are services that are advertised by relays, that designate routes that messages</span>
<span>to them can tunnel out to, outside of Indranet.</span></p><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>svcs</code></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Random value that ensures the signature is never placed on the same hash</span></td></tr><tr><td><span>33</span></td><td><span>Key</span></td><td><span>The public identity key of the relay providing relaying or other service</span></td></tr><tr><td><span>8</span></td><td><span>Expiry</span></td><td><span>The timestamp after which the ad must be renewed as all peers will evict the record from their network intelligence database</span></td></tr><tr><td><span>2</span></td><td><span>Count</span></td><td><span>Number of services advertised, consists of Port and RelayRate</span></td></tr><tr><td><span>2</span></td><td><span>Port</span></td><td><span>16 bit port number of service, based on Well Known Port</span></td></tr><tr><td><span>4</span></td><td><span>RelayRate</span></td><td><span>The cost in MilliSatoshi per megabyte of, the mean of request and response byte size</span></td></tr><tr><td><span>64</span></td><td><span>Signature</span></td><td><span>Schnorr signature that must match with the Key field above</span></td></tr></tbody></table></figure><p><a href='#contents'><span>⤴️</span></a></p><h3 id='hidden-services'><span>Hidden Services</span></h3><p><span>Hidden services are a composition of Primitives that enables the initiation and</span>
<span>message cycle of enabling bidirectional location obfuscation.</span></p><p><span>It borrows a little from the hidden service negotiation protocol used by Tor,</span>
<span>but the connection is maintained by the hidden server and hidden client</span>
<span>directly, bypassing the bottleneck and small attack surface created by a</span>
<span>mediated rendezvous connection.</span></p><h3 id='overview'><span>Overview</span></h3><p><span>Prior to explaining the parts, it is necessary to list them, and this is best</span>
<span>done as a numbered sequence, and the three parties involved we will use the</span>
<span>common names used in cryptography that apply to this protocol.</span></p><h4 id='alice'><span>Alice</span></h4><p><span>Alice is the hidden service provider. Alice is generally the initiator in most</span>
<span>scenarios described in cryptography.</span></p><h4 id='bob'><span>Bob</span></h4><p><span>Bob is the hidden client. Bob wants to talk to Alice, but doesn&#39;t know where she</span>
<span>is picking up messages from.</span></p><h4 id='faith'><span>Faith</span></h4><p><span>Faith is often used as a trusted intermediary, however in this protocol she is</span>
<span>serving in the role of an introducer, and her service is temporary.</span></p><p><span>Note that currently there is no scheme for billing hidden service traffic,</span>
<span>essentially the cost of relaying is borne equally by the hidden service and the</span>
<span>hidden client. Faith is essentially paid for this service as the hidden service</span>
<span>must have a session with her to do this. Each time a new introduction is</span>
<span>received, she is paid.</span></p><blockquote><p><span>note: in discussions of attacks on this protocol, the name </span><strong><span>Eve</span></strong><span> would be</span>
<span>perfect as the placeholder for the attacker.</span></p></blockquote><p><a href='#contents'><span>⤴️</span></a></p><h3 id='hidden-service-protocol'><span>Hidden Service Protocol</span></h3><ol start='' ><li><p><span>Alice wants to offer a hidden service, without disclosing to the network the</span>
<span>location where the data is being processed or stored. This has especially got</span>
<span>relevance to such services as trusted intermediaries, as a repository of</span>
<span>secrets, even if encrypted, is a high value target for attackers.</span></p></li><li><p><span>Alice generates an introduction message, which consists of her hidden</span>
<span>identity key, and the identity key of the chosen intermediary, Faith, is part</span>
<span>of this message.</span></p></li><li><p><span>The second part of her message is secret, and consists of a </span><strong><span>Reply</span></strong>
<span>message, which will be used to forward a request to Alice. In order to</span>
<span>prevent gathering any information about this return path, each one is single</span>
<span>use, and after an introduction is consumed, the introducer waits for a new</span>
<span>one.</span></p></li><li><p><span>The delivery of this introduction, and subsequent new Reply messages is done</span>
<span>via an anonymised pathway that is typically 3 hops, but could be shorter or</span>
<span>longer. </span><em><span>3 is just the magic number that is the maximum bang per buck for</span>
<span>creating a path that can be difficult to trace, similar to how an extraction</span>
<span>that takes 50% or better per pass exceeds 90% after 3. This is known as &quot;The</span>
<span>Rule of Three&quot;.</span></em></p></li><li><p><span>Faith broadcasts this introduction across the network, in part because when</span>
<span>hidden clients request a connection, she gets paid for forwarding the</span>
<span>request.</span></p></li><li><p><span>Because Faith has a privileged position as the go-between, where she is doing</span>
<span>a one-time version of the Tor hidden service, Alice will rotate the set of</span>
<span>introducers, that is, Alice will send out many of these public/private</span>
<span>intro/reply messages to peers, thus serving to create a moving target for</span>
<span>would-be attackers, and also, on the other side, Faith is the attack surface</span>
<span>for attempts to unmask the identity and location of Alice.</span></p></li><li><p><span>Bob receives the gossip about the various introducers related to the public</span>
<span>identity key of Alice&#39;s hidden service, and wants to start a hidden</span>
<span>conversation with her, without revealing his location either.</span></p></li><li><p><span>Bob sends a request to Faith via an obfuscated multi-hop path, containing a *</span>
<span>*Reply** header, which is then forwarded back to Alice by Faith using the</span>
<span>single use reply header she currently has for Alice.</span></p></li><li><p><span>Alice then receives this request, and then constructs a two or more layer</span>
<span>forwarding prefix to add an extra two or more hops on top of the path that</span>
<span>was given by Bob, the reason being that Bob might control the first hop, and</span>
<span>be trying to unmask Alice. In this way, he would be thwarted at such an</span>
<span>attempt. This reply is called </span><strong><span>Ready</span></strong><span>, and is like the Clear To Send signal</span>
<span>on a serial connection, this step in the process akin to the handshake of TCP</span>
<span>or similar in that now both parties are ready to start a conversation.</span></p></li><li><p><span>Bob then receives this message, which contains a Reply header from Alice,</span>
<span>and Bob uses this, again with his own header prefix, to send a </span><strong><span>Request</span></strong>
<span>message, and wraps this in 2 or more hops to protect his location from the</span>
<span>relay Alice provided in her </span><strong><span>Reply</span></strong><span>.</span></p></li><li><p><span>This then gets back to Alice, who can then forward the </span><strong><span>Request</span></strong><span> on to the</span>
<span>actual hidden service server, who then returns a reply and Alice then wraps</span>
<span>this in her two or more forward layers, around Bob&#39;s </span><strong><span>Reply</span></strong><span> header and</span>
<span>inside that, the </span><strong><span>Response</span></strong><span> from the hidden service.</span></p></li></ol><p><a href='#contents'><span>⤴️</span></a></p><h3 id='protocol-messages-for-hidden-services'><span>Protocol Messages for Hidden Services</span></h3><p><span>Note that at all times, for reasons of eliminating the possibility of unmasking</span>
<span>either end of a hidden connection, each side prefixes their messages with at</span>
<span>least two hops in the path. This acts as a firewall against an evil counterparty</span>
<span>controlling the relay at the top of the </span><strong><span>Reply</span></strong><span>.</span></p><h4 id='intro'><span>Intro</span></h4><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>intr</code></td></tr><tr><td><span>8</span></td><td><span>Nonce</span></td><td><span>Random value that ensures the signature is always on a different hash</span></td></tr><tr><td><span>33</span></td><td><span>Key </span><span>*</span></td><td><span>Public key of the hidden service identity, matching the Signature below</span></td></tr><tr><td><span>33</span></td><td><span>Introducer</span></td><td><span>Public key of the relay that is serving as the introducer</span></td></tr><tr><td><span>8</span></td><td><span>Expiry</span></td><td><span>The timestamp after which, by the clock of the introducer that the intro will be evicted from its network intelligence database</span></td></tr><tr><td><span>64</span></td><td><span>Signature</span></td><td><span>Schnorr signature on the foregoing message that matches </span><strong><span>Key</span></strong></td></tr></tbody></table></figure><p><span>The intro is the publicly visible document that contains a signed designation of</span>
<span>the introducer (Faith) in the protocol.</span></p><p><span>It is gossiped over the Publish/Subscribe system of Indra that propagates</span>
<span>information about peers, their addresses, and their offered public services.</span></p><blockquote><p><span>*</span><span> This key is encoded in the Indranet </span><code>Based32</code><span> encoding, which is 26 lower</span>
<span>case Latin letters and 234679, which are the least ambiguous 6 numbers out of</span>
<span>the 10 Arabic number ciphers. This custom encoding is used because it provides</span>
<span>potential for later use of vanity addresses. But more than this... A note is</span>
<span>required about this.</span></p></blockquote><p><a href='#contents'><span>⤴️</span></a></p><h4 id='rate-limiting-hidden-service-advertisements'><span>Rate Limiting Hidden Service Advertisements</span></h4><p><span>Because there is no cost to generating, and a relatively low cost to publishing</span>
<span>hidden services, in order to limit the amount of new hidden service addresses,</span>
<span>they must contain a common 25 bit prefix that forms the word </span><code>indra</code><span>. Well, this</span>
<span>is the provisional idea, it may need to be a longer prefix than this to be</span>
<span>sufficiently limited in the context of possible ASIC devices for mining these</span>
<span>keys. Currently the public key derivation operation is fairly expensive, very</span>
<span>few Tor hidden services have more than 7 or 8 base32 characters forming their &quot;</span>
<span>vanity&quot; prefix.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='introduction'><span>Introduction</span></h4><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>inta</code></td></tr><tr><td><span>150</span></td><td><span>Intro</span></td><td><span>The intro advertisement</span></td></tr><tr><td><span>...</span></td><td><span>Reply</span></td><td><span>The Reply message that the introducer returns a Route back with</span></td></tr></tbody></table></figure><p><span>Introduction is the message sent out by a hidden service, over a multi-hop path,</span>
<span>to the Introducer they have chosen for a time to serve as introducer.</span></p><p><span>The Intro is gossiped via the Publish Subscribe peer to peer protocol, and every</span>
<span>time a client sends a Route request, the hidden service will send a new one, as</span>
<span>it will refuse to accept the second one of these.</span></p><p><span>This prevents a race condition and the possible plaintext attack that the same</span>
<span>cipher set might open up.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='route'><span>Route</span></h4><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>rout</code></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>Random value used by the hidden client to identify the connection request</span></td></tr><tr><td><span>...</span></td><td><span>Reply</span></td><td><span>The path to send back the Ready signal</span></td></tr></tbody></table></figure><p><span>Route is essentially a connection request, after which the hidden client will</span>
<span>excpect to receive a Ready message containing a new </span><strong><span>Reply</span></strong><span> header to send a *</span>
<span>*Request**.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='ready'><span>Ready</span></h4><figure class='table-figure'><table><thead><tr><th><span>Byte length</span></th><th><span>Name</span></th><th><span>Description</span></th></tr></thead><tbody><tr><td><span>4</span></td><td><span>Magic</span></td><td><code>redy</code></td></tr><tr><td><span>8</span></td><td><span>ID</span></td><td><span>The random value that was sent in the request is returned with the reply for quick retrieval</span></td></tr><tr><td><span>...</span></td><td><span>Reply</span></td><td><span>The </span><strong><span>Reply</span></strong><span> header the hidden client can use to reply</span></td></tr></tbody></table></figure><p><span>The ready message essentially functions in the same way as a standard handshake</span>
<span>acknowledgement, which establishes that both sides are ready to begin a</span>
<span>conversation, and the first request may be sent.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='hidden-message-cycles'><span>Hidden Message Cycles</span></h4><p><span>Aside from the unmasking prevention prefixes, and the </span><strong><span>Reply</span></strong><span> headers, the</span>
<span>pattern of </span><strong><span>Request</span></strong><span> and </span><strong><span>Response</span></strong><span> are the same as any client/server</span>
<span>protocol.</span></p><p><span>In order to maintain the connection, each side retains a number of prior </span><strong><span>Reply</span>
</strong><span> headers (3-5?) that were sent, and in the event of a transmission failure,</span>
<span>the former, known successful </span><strong><span>Reply</span></strong><span> headers are retained for resending the</span>
<span>message that did not get a reply. The TTL of such chatter is governed by the</span>
<span>protocol that is being transported, on its &quot;Application&quot; layer, to use OSI layer</span>
<span>cake nomenclature.</span></p><p><span>In the event that the client consumes all of its cached past </span><strong><span>Reply</span></strong><span> headers</span>
<span>for the service, it can simply search out, or just use, other </span><strong><span>Intro</span></strong>
<span>advertisements that it has received over the gossip network, and reestablish the</span>
<span>connection.</span></p><blockquote><p><span>todo: Reply headers probably need an expiry?</span></p></blockquote><p><a href='#contents'><span>⤴️</span></a></p><h4 id='example-custom-protocols'><span>Example Custom Protocols</span></h4><blockquote><p><span>todo: some examples of other ways to use the primitives described in the</span>
<span>foregoing, here are some headings:</span></p><ol start='' ><li><p><span>Time Delay Data Storage</span></p></li><li><p><span>Metered Network Access</span></p></li><li><p><span>Paywalling access to content/databases/application</span></p></li><li><p><span>Additionally maybe discuss various strategies for defining paths, most</span>
<span>especially, forks. Oh, I will discuss that in a section above this.</span></p></li></ol></blockquote><h2 id='glossary'><span>Glossary</span></h2><p><a href='#contents'><span>⤴️</span></a></p><h4 id='based32'><span>Based32</span></h4><p><span>Based32 is a variant of Base 32 encoding which provides all letters of the</span>
<span>alphabet in lower case to make it possible to have any human readable segment</span>
<span>generated in a public key to assist with recognition and/or act as part of a</span>
<span>proof of work style limit on generating hidden service identity keys.</span></p><p><span>The ciphers are the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">abcdefghijklmnopqrstuvwxyz234679</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre><p><span>This should be adequately resistant to transcription errors due to the relative</span>
<span>differences between the ciphers as rendered in most fonts and handwriting. Only</span>
<span>i, t and l are a little similar visually. Omitting capital letters sidesteps the</span>
<span>ambiguity between Z and 2, 5 and S, 6 and G. g and 9 are similar in some</span>
<span>renderings, as can be 9 and q, but 0, 1, 5, 8 are the most ambiguous numbers</span>
<span>alongside lower case Latin letters.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='client'><span>Client</span></h4><p><span>Client is an application that constructs messages using this message format to</span>
<span>have the data transported in the intended way across the network to its intended</span>
<span>destination and back.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='ecdh'><span>ECDH</span></h4><p><span>Elliptic Curve Diffie Hellman Key Exchange is a scheme that uses asymmetric (</span>
<span>Public Key Infrastructure) cryptography to enable two parties to create a shared</span>
<span>symmetric encryption cipher (for AES encryption) over an insecure channel,</span>
<span>without enabling eavesdroppers or other attackers to acquire this secret and</span>
<span>compromise the privacy of their messages.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='header-key'><span>Header Key</span></h4><p><span>Used for the construction of simple </span><a href='#forward'><span>Forward</span></a><span>, for </span><a href='#reply'><span>Reply</span></a>
<span>message construction, as contrasted with the </span><a href='#'><span>Payload</span></a><span> key, which is</span>
<span>used for the separate segment of the message found after the </span><a href='#crypt'><span>Crypt</span></a>
<span>Offset.</span></p><p><span>This is a 32 byte Elliptic Curve private key, used with other keys to generate</span>
<span>symmetric encryption shared secrets using Elliptic Curve Diffie</span>
<span>Hellman (</span><a href='#ecdh'><span>ECDH</span></a><span>) key agreement protocol, the same as</span>
<span>the </span><a href='#'><span>Payload Key</span></a><span>.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='payload-key'><span>Payload Key</span></h4><p><span>After a </span><a href='#crypt'><span>Crypt</span></a><span> Offset number of bytes, which is the first 3 bytes</span>
<span>encrypted by the </span><a href='#header'><span>Header</span></a><span> Key, this is the second key found in</span>
<span>a </span><a href='#session'><span>Session</span></a><span>, which enables the creation of a bidirectional message</span>
<span>construction scheme that is controlled primarily by the client.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='initialisation-vector'><span>Initialisation Vector</span></h4><p><span>In order to prevent the repeat of generated encryption streams, every encrypted</span>
<span>message must have a provided, cleartext prefix that is concatenated to the</span>
<span>encryption secret to generate the beginning of the cipher stream/blocks.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='fingerprint'><span>Fingerprint</span></h4><p><span>A fingerprint is a shorter, usually derived value that makes it easier and</span>
<span>faster to identify a longer string of bytes. An example of this is the RIPEMD160</span>
<span>hash of the public key associated with a Bitcoin address. In Indra this is</span>
<span>generally done via SHA256 32 byte hash, that is truncated to a shorter length</span>
<span>for the purpose. The Cloaked Key is an example of the use of this with</span>
<span>a </span><a href='#nonce'><span>Nonce</span></a><span>.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='nonce'><span>Nonce</span></h4><p><span>A random value used for various reasons in cryptography. It is critical these</span>
<span>values are generated by a Cryptographically Secure Pseudo Random Number</span>
<span>Generator (CSPRNG) or entropy capture device, as patterns in these values can</span>
<span>lead to plaintext cryptanalysis attacks that can uncover symmetric ciphers</span>
<span>and/or private keys.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='relay'><span>Relay</span></h4><p><span>An Indranet relay is a server that accepts payments via the custom configured</span>
<span>Indra Lightning Network sub-net, that has no routing fees due to the primary</span>
<span>charging method of </span><a href='#session'><span>Session</span></a><span>s.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='sessions'><span>Sessions</span></h4><p><span>A session is a pre-paid balance denominated in MilliSatoshi, 1/1000th of a</span>
<span>Satoshi, the primary unit of the Bitcoin ledger. Sessions are created by making</span>
<span>a payment via LN to the relay&#39;s identity key (one key that is used by</span>
<span>the </span><a href='#relay'><span>Relay</span></a><span>, Lightning node and Bitcoin node) using Atomic Multi-Path</span>
<span>payments, initiated by </span><a href='#client'><span>Client</span></a><span>s and constructed so as to hide the</span>
<span>origin of the payment.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='preimage'><span>Preimage</span></h4><p><span>In the Lightning Network, payment contain a 32 byte hash value that associates</span>
<span>with the payment a secondary piece of data used to prove/confirm the payment. In</span>
<span>Indra, this data relates to the hash of the </span><a href='#header'><span>Header</span></a>
<span>and </span><a href='#'><span>Payload</span></a><span> of a </span><a href='#session'><span>Session</span></a><span>.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='magic-bytes'><span>Magic Bytes</span></h4><p><span>These are a string of plain ASCII characters (Latin) of 8 bits per character,</span>
<span>and 4 bytes long to ensure that random byte sequences are unlikely to occur in</span>
<span>the positions that the Magic should appear. Primarily used to indicate the</span>
<span>beginning of a message, at the front of packets and directly after previous</span>
<span>messages.</span></p><p><span>These enable fast recognition of the encoding to be expected, and the fields</span>
<span>that will be found within a message segment by relays.</span></p><p><span>They are like the methods in an API, and are followed by the parameters that the</span>
<span>API call requires.</span></p><p><a href='#contents'><span>⤴️</span></a></p><h4 id='cloaked-key'><span>Cloaked Key</span></h4><p><span>A Cloaked key is a way of indicating the use of a</span>
<span>specific </span><a href='#sessions'><span>Session&#39;s</span></a><span> keys, specifically referring to</span>
<span>the </span><a href='#header'><span>Header key</span></a><span>.</span></p><p><span>This is generated using a random blinding factor, that is concatenated with the</span>
<span>public key and appended to the end of the blinding factor, as follows:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">fingerprint = hash ( nonce | public key ) -&gt; truncated to 4 bytes</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cloak = nonce | fingerprint</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><p><span>The vertical bar </span><code>|</code><span> represents the concatenation of the items on either side of</span>
<span>it, for example: 123 | 4567890 = 1234567890</span></p><p><span>The relay can then scan its session database by generating the same construction</span>
<span>using the same method just described to determine if the candidate key matches,</span>
<span>as it iterates its </span><a href='#sessions'><span>Sessions</span></a><span> database.</span></p><p><span>Cloaking prevents any relay other than the one that has the </span><a href='#session'><span>Session</span></a>
<span>gathering any information about the identity of a session connecting two or more</span>
<span>messages sent by the same </span><a href='#client'><span>Client</span></a><span>.</span></p></div></div>
</body>
</html>